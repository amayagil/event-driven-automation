# Introducing Ansible Event Driven Automation

This repo shows a simple demo to showcase event driven automation using ansible and rulebooks.

The rulebook instantiates three different listeners: Kafka, Alertmanager and a simple Webhook listener

Each of those listeners react to events, either greeting the caller (Kafka/webhook) or trying to remediate to an alert triggered by the application via playbooks that are part of the demo.

Events are generated by a Quarkus application, listening on port *8080* on localhost, that exposes the following endpoints

    /alertmanager/greeting
    /kafka/greeting
    /webhook/greeting

## Usage

The stack is composed by four containers:

- Kafka container to instantiate the broker
- Alertmanager container to set-up an alertmanager instance
- Quarkus-client container that will act as an event generator
- Ansible EDA container image, running the ansible bits

A pre-built **podman-compose.yml** is present in the repo to allow a quick setup of the stack via:

    podman-compose up

It will start all services and your endpoints will be soon available to test:

    curl localhost:8080/alertmanager/greeting
    curl localhost:8080/webhook/greeting
    curl localhost:8080/kafka/greeting

If you check in the logs of the Ansible Container you can see the output of the executions:

    podman logs -f event-driven-automation_ansible_1

    INFO:ansible_rulebook.builtin:ruleset: Listen for events on multiple sources (Kafka, Webhook, AlertManager), rule: Let Ansible print information about the alert
    INFO:ansible_rulebook.builtin:Calling Ansible runner

    PLAY [Playbook reacting to AlertManager Event] *********************************

    TASK [Gathering Facts] *********************************************************
    ok: [localhost]

    TASK [Debug message] ***********************************************************
    ok: [localhost] => {
        "msg": "The event myalert just triggered to greet Ansible Event Driven!"
    }

    TASK [Remediating issue to resolve the alert] **********************************
    ok: [localhost] => {
        "msg": "Tring to solve myalert"
    }

    TASK [Notify resolution] *******************************************************
    skipping: [localhost]

    PLAY RECAP *********************************************************************
    localhost                  : ok=3    changed=0    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0